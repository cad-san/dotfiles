#!/bin/sh

# search histroy with percol
_replace_by_history() {
  local l=$(HISTTIMEFORMAT= history | tac | sed -e 's/^\s*[0-9]\+\s\+//' | percol --query "$READLINE_LINE")
  READLINE_LINE="$l"
  READLINE_POINT=${#l}
}
bind -x '"\C-r": _replace_by_history'
bind    '"\C-xr": reverse-search-history'

# for git
function percol-git-branch() {
	git branch | percol | sed -e "s/^\*[ ]*//g"
}

function percol-git-status-files () {
    git status --porcelain | percol | awk '{ print $2 }'
}

function percol-git-ls-files() {
	git ls-files | percol
}

alias gpbr='percol-git-branch | xargs --no-run-if-empty git'
alias gpls='percol-git-ls-files | xargs --no-run-if-empty git'
alias gpst='percol-git-status-files | xargs --no-run-if-empty git'

_replace_by_git_ls_files() {
	local l=$(percol-git-ls-files)
	READLINE_LINE="$READLINE_LINE $l"
	READLINE_POINT=${#READLINE_LINE}
}
bind -x '"\C-f": _replace_by_git_ls_files'

# for advanced cd func
_replace_by_acd () {
	local l=$(cd -- | percol | awk '{ print $2 }')

	READLINE_LINE="cd $l"
	READLINE_POINT=${#READLINE_LINE}
}
bind -x '"\C-j": "_replace_by_acd"'
